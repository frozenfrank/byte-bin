#!/usr/bin/env bash

# Usage: ./folder_toc.sh [directory]
# Default: current directory

ROOT="${1:-.}"

print_tree() {
    local dir="$1"
    local indent="$2"

    # Count only NON-hidden regular files directly in this directory
    local file_count
    file_count=$(find "$dir" \
        -maxdepth 1 \
        -type f \
        ! -name '.*' \
        2>/dev/null | wc -l)

    local folder_size
    folder_size=$(du -sh "$dir" 2>/dev/null | awk '{print $1; exit}')

    printf "%sðŸ“ %s (%d files, %s)\n" "$indent" "$(basename "$dir")" "$file_count" "$folder_size"

    # Recurse into NON-hidden subdirectories only
    find "$dir" \
        -maxdepth 1 \
        -mindepth 1 \
        -type d \
        ! -name '.*' \
        2>/dev/null | sort | while IFS= read -r subdir; do
            print_tree "$subdir" "$indent    "
        done
}

echo "Folder Table of Contents"
echo "========================"

print_tree "$ROOT" ""
